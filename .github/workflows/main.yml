name: Fixed Offline App V7
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Environment
        uses: actions/setup-node@v4
        with: {node-version: 20}
      - uses: actions/setup-java@v4
        with: {java-version: '17', distribution: 'temurin'}

      - name: ğŸ§¹ Organize & Prepare Files
        run: |
          # 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù†Ø¸ÙŠÙ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
          mkdir final_app_folder
          
          # 2. Ù†Ù‚Ù„ Ù…Ù„ÙØ§ØªÙƒ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙ‚Ø· Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ (Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù„Ø®Ø¨Ø·Ø©)
          # Ù†Ù†Ù‚Ù„ Ù…Ù„Ù Ø§Ù„Ø§Ù†Ø¯ÙƒØ³
          cp index.html final_app_folder/ 2>/dev/null || echo "No index at root"
          
          # Ù†Ù†Ù‚Ù„ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª)
          cp -r assets final_app_folder/ 2>/dev/null || echo "No assets folder"
          
          # Ù†Ù†Ù‚Ù„ Ø£ÙŠ Ù…Ù„ÙØ§Øª Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ø£Ùˆ CSS Ø³Ø§Ø¦Ø¨Ø©
          cp *.js final_app_folder/ 2>/dev/null || true
          cp *.css final_app_folder/ 2>/dev/null || true
          
          echo "âœ… Files inside app folder:"
          ls -R final_app_folder/

      - name: ğŸ—ï¸ Build Native App (No Pull-to-Refresh)
        run: |
          # ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª
          npm init -y
          npm install @capacitor/core @capacitor/cli @capacitor/android
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø¸ÙŠÙ
          npx cap init AjwanApp com.ajwan.final --web-dir final_app_folder
          
          # Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ (ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ ÙƒØ§Ø¨Ø³ØªÙˆØ±)
          npx cap add android
          
          # Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
          cd android
          chmod +x gradlew
          ./gradlew assembleDebug

      - uses: actions/upload-artifact@v4
        with:
          name: Ajwan-Fixed-APK
          path: android/app/build/outputs/apk/debug/app-debug.apk
