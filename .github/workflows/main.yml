name: Offline App V5 (Safe Copy)
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Environment
        uses: actions/setup-node@v4
        with: {node-version: 20}
      - uses: actions/setup-java@v4
        with: {java-version: '17', distribution: 'temurin'}

      - name: ğŸ“‚ Organize Files Safely
        run: |
          # 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù…Ø¤Ù‚Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª
          mkdir ../temp_site
          
          # 2. Ù†Ø³Ø® Ù…Ù„ÙØ§ØªÙƒ (HTML/JS) Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø¤Ù‚Øª
          cp -r * ../temp_site/
          
          # 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙÙ‡Ù…Ù‡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          mkdir www
          
          # 4. Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­
          cp -r ../temp_site/* www/ 2>/dev/null || true
          
          echo "âœ… Files moved to 'www' successfully."

      - name: ğŸ› ï¸ Install & Build APK
        run: |
          # ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù…Ù† Ø§Ù„ØµÙØ±
          npm init -y
          npm install @capacitor/core @capacitor/cli @capacitor/android
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒØ§Ø¨Ø³ØªÙˆØ± Ù„ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø¬Ù„Ø¯ www
          npx cap init App com.ajwan.offline --web-dir www
          npx cap add android
          
          # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡
          cd android
          chmod +x gradlew
          ./gradlew assembleDebug

      - uses: actions/upload-artifact@v4
        with:
          name: Ajwan-V5-APK
          path: android/app/build/outputs/apk/debug/app-debug.apk
